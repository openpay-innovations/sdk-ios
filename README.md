# Openpay iOS SDK

The Openpay SDK for iOS allows you to integrate Openpay with ease. It provides a framework and documentation for developers to enable payments for customers.

## Integration

### Requirements
- iOS 13 or later
- Swift 5.3 or later
- Xcode 12 or later


### CocoaPods
[CocoaPods](https://cocoapods.org) is a dependency manager for Swift and Objective-C Cocoa projects. For installation and usage instructions, please visit their website for details. To integrate the Openpay SDK into your Xcode project using CocoaPods, add it to your `Podfile`:
```
pod 'openpay', '~> 1.0'
```

### Carthage
[Carthage](https://github.com/Carthage/Carthage) is a dependency manager that builds your dependencies to provide you with binary frameworks. To integrate the Openpay SDK into your Xcode project using Carthage, add it to your `Cartfile`:
```
github "openpay-innovations/sdk-ios" ~> 1.0
```

### Swift Package Manager
The [Swift Package Manager](https://swift.org/package-manager/) is a tool for managing the distribution of Swift code. To integrate Openpay SDK into your Xcode project using SPM, add it to your `Package.swift`:
```
dependencies: [
    .package(url: "https://github.com/openpay-innovations/sdk-ios.git", .upToNextMajor(from: "1.0.0"))
]
```

### Manually

#### XCFrameworks
The XCFramework of the Openpay SDK can be generated by following the [official documentation](https://help.apple.com/xcode/mac/11.4/#/dev544efab96).
#### Git Submodules
Follow the steps below to add the Openpay SDK as a [git submodule](https://git-scm.com/docs/git-submodule):
- Navigate to the root of your working directory
- Run the command to add the SDK as a submodule
    
    ```
    git submodule add https://github.com/openpay-innovations/sdk-ios.git Openpay
    ```
- Open the new `Openpay` folder and drag `Openpay.xcodeproj` into the Project Navigator of your application's Xcode project.
- Select `Openpay.xcodeproj` in the Project Navigator and make sure that the deployment target matches that of your application target.
- Select your application project and navigate to the target configuration window.
- Select the application target under the "Targets" heading in the sidebar.
- Open the "General" panel in the tab bar at the top of that window.
- Click on the `+` button under the "Frameworks, Libraries, and Embedded Content" section.
- Select `Openpay.framework`.

That's all you need to import the Openpay SDK and you can now build it on the device and simulator.

## Examples
The [example project](https://github.com/openpay-innovations/sdk-ios/tree/main/Example) sets an example of how the payment flow works with the web checkout.
Check out the example project under `Openpay.xcworkspace`.

## Building
### Mint
[Mint](https://github.com/yonaskolb/Mint) is a package manager that installs and runs Swift command line tool packages. The Openpay SDK uses Mint to install and run the packages listed in the `Mintfile` such as [SwiftLint](https://github.com/realm/SwiftLint).

You can simply build the SDK project with Cmd + B or run the [Scripts/bootstrap-tools] script to install all the Swift command line tool packages before the first build to speed up the build time.

You do not need to install mint manually as an extra step because a pre-compiled Mint executable file is included under the directory [Tools/mint](https://github.com/openpay-innovations/sdk-ios/tree/main/Tools/mint).

## Features
### Web Checkout View
The web checkout view can be modally presented, passing the URL encoded transaction token and the base handover URL. When the web checkout flow is completed, the view will be dismissed and xx return the checkout result.

The transaction token and the base handover URL are generated via the /orders endpoint on the Openpay backend. Note that the transaction token returned from the Openpay backend is already URL encoded so you do not need to encode it again.

#### Swift - UIKit
```
    final class CheckoutViewController: UIViewController {
        private func presentCheckoutWebView(transactionToken: String, handoverURL: URL) {
            Openpay.presentWebCheckoutView(
                over: self,
                transactionToken: transactionToken,
                handoverURL: handoverURL,
                completion: { result in
                    switch result {
                    case .success(.webLodged(let planId, _)):
                        // Handle the successful result
                    case .failure(let failure):
                        // Handle the failure result
                    }
                }
            )
        }
    }
```

#### Objective-C
```
  + (void)presentWebCheckoutViewOverViewController:(UIViewController *)viewController
                                  transactionToken:(NSString *)token
                                       handoverURL:(NSURL *)url
                                          animated:(BOOL)flag
                                  webLodgedHandler:(WebLodgedHandler)webLodgedHandler {

      void (^completion)(OPWebCheckoutResult *) = ^(OPWebCheckoutResult *result) {
          OPSuccess *success = [(OPWebCheckoutResultSuccess *)result status];

          // Handle the successful result
          if ([success isKindOfClass:[OPWebLodged class]]) {
              OPWebLodged *webLodged = (OPWebLodged *)success;
              webLodgedHandler([webLodged planId], [webLodged orderId]);
              return;
          }

          OPFailure *failure = [(OPWebCheckoutResultFailure *)result status];
          // Handle different types of failure
          if ([failure isKindOfClass:[OPWebCancelled class]]) {
              OPWebCancelled *webCancelled = (OPWebCancelled *)failure;
              webCancelledHandler([webCancelled planId], [webCancelled orderId]);
              return;
          }
          ...
      };
      [OPOpenpay presentWebCheckoutViewOverViewController:viewController
                                         transactionToken:token
                                              handoverURL:url
                                                 animated:flag
                                               completion:completion];
  }
```

#### SwiftUI
```
    struct MainView: View {
        @State private var checkoutItem = CheckoutItem(transactionToken: "", handoverURL: "")
        var body: View {
          SomeCheckoutView()
          .openpayWebCheckoutView(checkoutItem: $checkoutItem) { result in
              // Handle the checkout result
          }
        }
    }
```

### Openpay Payment Button
The Openpay SDK provides several payment buttons you can use to let people make the payment with Openpay. The following button styles are available in the SDK.

More details of the payment button see [SDK Styleguide](https://xd.adobe.com/view/162312e4-d288-46ce-89f2-60dc5d66221c-4370/specs/).

#### Amber with Granite Grey

| Granite On Amber | Amber On Granite |
| ---------------- | ---------------- |
| ![Payment Button Granite On Amber](Support/Images/payment_button_graniteOnAmber.svg) | ![Payment Button Amber On Granite](Support/Images/payment_button_amberOnGranite.svg) |

#### Granite grey with White

| Granite On White | White On Granite |
| ---------------- | ---------------- |
| ![Payment Button Granite On White](Support/Images/payment_button_graniteOnWhite.svg) | ![Payment Button White On Granite](Support/Images/payment_button_whiteOnGranite.svg) |

Maintain the minimum button size around the button in iOS. Use the following values for guidance.
| Minimum Width | Maximum Width | Minimum Height |
| ------------- | ------------- | -------------- |
| 218pt         | 380pt         |      48pt      |

You get the following advantages by using the Openpay payment button
- Support for configuring the buttonâ€™s corner radius to match the style of your UI
- Support for accessibility label that lets VoiceOver describe the button
- Support for light and dark mode
- Adjust the corner radius to match the appearance of other buttons in your app

#### Example
```
// Initialize a Openpay checkout button using graniteOnAmber theme on light mode and amberOnGranite theme on dark mode.
// The OpenpayPaymentButton is a subclass of UIButton
let checkoutButton = OpenpayPaymentButton(theme: .dynamic(light: .graniteOnAmber, dark: .amberOnGranite))
```

### Openpay Badge
The Openpay SDK provides four different color schemes for the badge view. The following button styles are available in the SDK.

More details of the badge see [SDK Styleguide](https://xd.adobe.com/view/162312e4-d288-46ce-89f2-60dc5d66221c-4370/specs/).

#### Amber with Granite Grey
| Granite On Amber | Amber On Granite | Minimum Width |
| --- | ----------- | ----------- |
| ![Payment Button Granite On Amber](Support/Images/badge_graniteOnAmber.svg) | ![Payment Button Amber On Granite](Support/Images/badge_amberOnGranite.svg) | 75pt          |

#### Light
The badge is the Openpay logo without background color under this theme.

| White | Granite | Minimum Width |
| --- | ----------- | ----------- |
| ![Payment Button Granite](Support/Images/badge_granite.svg) | ![Payment Button White](Support/Images/badge_white.svg) | 80pt          |

You get the following advantages by using the Openpay badge
- The badge view can be scaled to to match the style of your UI
- Support for accessibility label that lets VoiceOver describe the badge
- Support for light and dark mode

#### Example
```
// Initialize a Openpay badge using graniteOnAmber color scheme on light mode and amberOnGranite color scheme on dark mode.
// The OpenpayBadge is a subclass of UIView
let openpayBadge = OpenpayBadge(theme: .dynamic(light: .graniteOnAmber, dark: .amberOnGranite))
```

### Themes
The Openpay SDK allow developers to apply different color schemes for different user interfaces. The following themes are available in the SDK.
- Universal
  
  The universal theme uses a static color scheme and does not adapt to light and dark interfaces. 
- Dynamic
  
  The dynamic theme adapts to light and dark interfaces.



